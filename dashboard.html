<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PILOTAGE B2B MOBILIS - Direction Commerciale</title>
    <script>if (sessionStorage.getItem('dashboard_auth') !== 'true') window.location.href = 'index.html';</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-card: #1f2937;
            --bg-card-hover: #374151;
            --border: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.3);
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.15);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.15);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.15);
            --purple: #8b5cf6;
            --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px var(--accent-glow);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* HEADER PREMIUM */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-logo {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.25rem;
            box-shadow: var(--shadow-glow);
        }

        .brand-text h1 {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .brand-text span {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* NAVIGATION TABS */
        .nav-tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-primary);
            padding: 0.25rem;
            border-radius: 10px;
        }

        .nav-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.6rem 1.25rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }

        .nav-tab.active {
            background: var(--accent);
            color: white;
            box-shadow: var(--shadow-glow);
        }

        /* FILTERS */
        .filters {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .filter-group {
            position: relative;
        }

        .filter-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent);
        }

        .filter-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.5rem;
            min-width: 160px;
            z-index: 200;
            display: none;
            box-shadow: var(--shadow-lg);
        }

        .filter-menu.open {
            display: block;
        }

        .filter-menu label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.5rem;
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.15s;
        }

        .filter-menu label:hover {
            background: var(--bg-card-hover);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .date-display {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .btn-logout {
            background: var(--danger-bg);
            color: var(--danger);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-logout:hover {
            background: var(--danger);
            color: white;
        }

        /* MAIN CONTENT */
        .main {
            padding: 1.5rem 2rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* GRID SYSTEM */
        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-2-1 {
            grid-template-columns: 2fr 1fr;
        }

        .grid-1-2 {
            grid-template-columns: 1fr 2fr;
        }

        /* CARDS */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-badge {
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
            font-weight: 600;
        }

        /* KPI CARDS - PREMIUM */
        .kpi-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 16px 0 0 16px;
        }

        .kpi-card.success::before {
            background: var(--gradient-success);
        }

        .kpi-card.warning::before {
            background: var(--gradient-warning);
        }

        .kpi-card.danger::before {
            background: var(--gradient-danger);
        }

        .kpi-card.primary::before {
            background: var(--gradient-primary);
        }

        .kpi-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .kpi-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .kpi-value {
            font-size: 1.75rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .kpi-sub {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: 600;
        }

        .kpi-trend.up {
            background: var(--success-bg);
            color: var(--success);
        }

        .kpi-trend.down {
            background: var(--danger-bg);
            color: var(--danger);
        }

        /* GAUGE PREMIUM */
        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
        }

        .gauge-svg {
            width: 160px;
            height: 90px;
        }

        .gauge-value {
            font-size: 2rem;
            font-weight: 800;
            margin-top: -0.5rem;
        }

        .gauge-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .gauge-target {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: var(--bg-primary);
            border-radius: 6px;
        }

        /* STAR PERFORMER */
        .star-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .star-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: #1f2937;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
        }

        .star-info {
            flex: 1;
        }

        .star-name {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .star-stats {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .star-badges {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.5rem;
        }

        /* BADGES */
        .badge {
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.6rem;
            font-weight: 600;
        }

        .badge.success {
            background: var(--success-bg);
            color: var(--success);
        }

        .badge.warning {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .badge.danger {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .badge.primary {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent);
        }

        /* DATA TABLE PREMIUM */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            background: var(--bg-primary);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .data-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .data-table tr:hover td {
            background: var(--bg-card-hover);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* PROGRESS BAR */
        .progress {
            width: 80px;
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-fill.success {
            background: var(--gradient-success);
        }

        .progress-fill.warning {
            background: var(--gradient-warning);
        }

        .progress-fill.danger {
            background: var(--gradient-danger);
        }

        /* CHART CONTAINER */
        .chart-box {
            height: 200px;
            position: relative;
        }

        .chart-box.lg {
            height: 280px;
        }

        .chart-box.xl {
            height: 350px;
        }

        /* MAP */
        #mapBox {
            height: 350px;
            border-radius: 12px;
            overflow: hidden;
        }

        /* TOP ITEMS */
        .top-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .top-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem;
            background: var(--bg-primary);
            border-radius: 10px;
            transition: all 0.15s;
        }

        .top-item:hover {
            background: var(--bg-card-hover);
            transform: translateX(4px);
        }

        .top-rank {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
        }

        .top-rank.gold {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1f2937;
        }

        .top-rank.silver {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
        }

        .top-rank.bronze {
            background: linear-gradient(135deg, #d97706, #b45309);
            color: white;
        }

        .top-rank.default {
            background: var(--bg-card);
            color: var(--text-secondary);
        }

        .top-info {
            flex: 1;
        }

        .top-name {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .top-sub {
            font-size: 0.6rem;
            color: var(--text-muted);
        }

        .top-value {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--success);
        }

        /* PREDICTION CARD */
        .prediction-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 1rem;
        }

        .prediction-title {
            font-size: 0.7rem;
            color: var(--purple);
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .prediction-value {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .prediction-detail {
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        /* ALERT BOX */
        .alert-box {
            padding: 1rem;
            border-radius: 12px;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert-box.danger {
            background: var(--danger-bg);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .alert-box.warning {
            background: var(--warning-bg);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .alert-box.success {
            background: var(--success-bg);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .alert-icon {
            font-size: 1.25rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .alert-text {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* RESPONSIVE */
        @media (max-width: 1400px) {
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1024px) {

            .grid-3,
            .grid-2-1,
            .grid-1-2 {
                grid-template-columns: 1fr;
            }

            .header {
                flex-wrap: wrap;
                gap: 1rem;
                padding: 1rem;
            }

            .main {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {

            .grid-4,
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                overflow-x: auto;
            }

            .filters {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="brand">
            <div class="brand-logo">M</div>
            <div class="brand-text">
                <h1>PILOTAGE B2B</h1>
                <span> R√©gion Ouest</span>
            </div>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-page="cockpit">üìä Cockpit</button>
            <button class="nav-tab" data-page="performance">üéØ Performance</button>
            <button class="nav-tab" data-page="territoire">üó∫Ô∏è Territoire</button>
            <button class="nav-tab" data-page="coaching">üí° Coaching</button>
        </nav>

        <div class="filters">
            <div class="filter-group">
                <button class="filter-btn" onclick="toggleFilter('moisMenu')">üìÖ P√©riode <span
                        style="opacity:.5">‚ñº</span></button>
                <div id="moisMenu" class="filter-menu">
                    <label><input type="checkbox" value="01" checked onchange="updateAll()"> Janvier 2026</label>
                    <label><input type="checkbox" value="02" onchange="updateAll()"> F√©vrier 2026</label>
                    <label><input type="checkbox" value="03" onchange="updateAll()"> Mars 2026</label>
                </div>
            </div>
            <div class="filter-group">
                <button class="filter-btn" onclick="toggleFilter('commMenu')">üë§ √âquipe <span
                        style="opacity:.5">‚ñº</span></button>
                <div id="commMenu" class="filter-menu"></div>
            </div>
        </div>

        <div class="header-actions">
            <span class="date-display" id="currentDate"></span>
            <button class="btn-logout" onclick="logout()">D√©connexion</button>
        </div>
    </header>

    <main class="main">
        <!-- COCKPIT -->
        <div id="page-cockpit" class="page active">
            <!-- KPIs Principaux -->
            <div class="grid grid-4" style="margin-bottom:1rem" id="kpiGrid"></div>

            <!-- Jauges + Star + Pr√©diction -->
            <div class="grid grid-3" style="margin-bottom:1rem">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìà R√©alisation CA</span>
                        <span class="card-badge badge primary" id="periodeLabel">1 mois</span>
                    </div>
                    <div class="gauge-container" id="gaugeCA"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üîç Prospection</span>
                    </div>
                    <div class="gauge-container" id="gaugeProsp"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">‚≠ê Meilleure Performance</span>
                    </div>
                    <div id="starBox"></div>
                    <div class="prediction-box" style="margin-top:1rem" id="predictionBox"></div>
                </div>
            </div>

            <!-- Graphiques -->
            <div class="grid grid-2" style="margin-bottom:1rem">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìä R√©partition CA par Commercial</span>
                    </div>
                    <div class="chart-box"><canvas id="caChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìà Activit√© Commerciale</span>
                    </div>
                    <div class="chart-box"><canvas id="activityChart"></canvas></div>
                </div>
            </div>

            <!-- Alertes -->
            <div id="alertsBox" style="margin-bottom:1rem"></div>

            <!-- Tableau √âquipe -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üë• Performance √âquipe</span>
                    <span class="card-badge badge primary" id="teamCount">0 commerciaux</span>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Commercial</th>
                                <th>Territoire</th>
                                <th>Visites</th>
                                <th>Prospects</th>
                                <th>CA R√©alis√©</th>
                                <th>% Objectif</th>
                                <th>Tendance</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="teamTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PERFORMANCE -->
        <div id="page-performance" class="page">
            <div class="grid grid-2" style="margin-bottom:1rem">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üèÜ Classement CA</span>
                    </div>
                    <div class="chart-box lg"><canvas id="rankingChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìä Comparaison Objectifs</span>
                    </div>
                    <div class="chart-box lg"><canvas id="compChart"></canvas></div>
                </div>
            </div>
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-header"><span class="card-title">ü•á Top Clients</span></div>
                    <div class="top-list" id="topClients"></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">üì¶ Top Produits</span></div>
                    <div class="top-list" id="topProduits"></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">üìà Indicateurs Cl√©s</span></div>
                    <div id="keyMetrics"></div>
                </div>
            </div>
        </div>

        <!-- TERRITOIRE -->
        <div id="page-territoire" class="page">
            <div class="grid grid-2-1" style="margin-bottom:1rem">
                <div class="card">
                    <div class="card-header"><span class="card-title">üó∫Ô∏è Carte des Performances</span></div>
                    <div id="mapBox"></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">üìä CA par Wilaya</span></div>
                    <div class="chart-box xl"><canvas id="wilayaChart"></canvas></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><span class="card-title">üìç D√©tail par Territoire</span></div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Wilaya</th>
                                <th>Commercial</th>
                                <th>Visites</th>
                                <th>CA</th>
                                <th>Potentiel</th>
                            </tr>
                        </thead>
                        <tbody id="territoryTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- COACHING -->
        <div id="page-coaching" class="page">
            <div class="grid grid-2" style="margin-bottom:1rem">
                <div class="card">
                    <div class="card-header"><span class="card-title">üìä Matrice Effort / R√©sultat</span></div>
                    <div class="chart-box xl"><canvas id="matriceChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">üéØ Priorit√©s d'Action</span></div>
                    <div id="priorityList"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><span class="card-title">üí° Plan d'Action Coaching</span></div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Priorit√©</th>
                                <th>Commercial</th>
                                <th>Diagnostic</th>
                                <th>Action Recommand√©e</th>
                                <th>D√©lai</th>
                            </tr>
                        </thead>
                        <tbody id="coachingTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script src="dashboard.js"></script>
</body>

</html>
